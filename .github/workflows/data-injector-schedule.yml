name: Geomonitor Data Injector

on:
  schedule:
    # Runs every 5 minutes (at minutes 0, 5, 10, etc.)
    - cron: '*/5 * * * *'
  # Allows manual triggering from the Actions tab
  workflow_dispatch:

jobs:
  inject_data_to_firebase:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout the repository code
      - uses: actions/checkout@v4

      # 2. Set up Python environment
      - uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      # 3. Install ALL required Python dependencies (geopy, requests, and no deprecated firebase library)
      - name: Install Dependencies
        # Installing the necessary libraries for geocoding and REST calls.
        run: pip install requests geopy



      # 4. Run the data injection script
      - name: Run Data Injector Script
        env:
          # --- FIX 1: Pass the NEWS_API_KEY to the script ---
          FIREBASE_URL: ${{ secrets.FIREBASE_URL }}
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }} 
        run: python data_injector.py

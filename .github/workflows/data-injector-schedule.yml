name: Geomonitor Data Injector

on:
  schedule:
    # Runs every 5 minutes (at minutes 0, 5, 10, etc.)
    - cron: '*/5 * * * *'
  # Allows manual triggering from the Actions tab
  workflow_dispatch:

jobs:
  inject_data_to_firebase:
    runs-on: ubuntu-latest
    
    steps:
      # 1. Checkout the repository code
      - uses: actions/checkout@v4

      # 2. Set up Python environment
      - uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      # 3. Install ALL required Python dependencies (The Fix!)
      - name: Install Dependencies
        # We now install geopy and requests in addition to firebase
        run: pip install python-firebase requests geopy

      # 4. Run the data injection script
      - name: Run Data Injector Script
        env:
          # Securely passes the Firebase URL and the NEWS API Key
          FIREBASE_URL: ${{ secrets.FIREBASE_URL }}
          NEWS_API_KEY: ${{ secrets.NEWS_API_KEY }} # <-- Now included!
        run: python data_injector.py
